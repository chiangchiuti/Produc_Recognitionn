# Product Recongnization
####目的：

```
	秋千 儿童 室内 婴儿幼儿童室内荡秋千户外 宝宝玩具
	儿童六一礼物儿童室内秋千户外吊椅室外荡秋千家用运动健身器材
	幼儿园儿童组合滑梯淘气堡室内滑梯宝宝游乐园滑滑梯秋千玩具包邮
	加厚滑滑梯儿童室内幼儿园婴儿玩具家用滑梯秋千组合海洋球球池
	滑梯批发 幼儿园儿童滑梯 室外最畅销塑料滑梯 秋千组合滑滑梯
	游乐设施幼儿园玩具户外大型小区儿童组合工程塑料室外幼儿园滑梯
```
以上字段是從淘寶網上爬取的標題，可以看出商家習慣性的把所有關鍵字塞進去，且沒明顯的分界。
目標是要將上面的句子分詞，並找出哪些是產品名。

####困難處：
* 特定領域的分詞任務，general 分詞器（Jieba hanglp) 可能效用不佳
* 產品名歧異大，人都很難說準什麼是產品
	* ex: 儿童组合滑梯淘气堡？ 淘气堡？ 组合滑梯？ 组合滑梯淘气堡？


####流程分成三大步驟：

1. Pattern Discovery： 分詞和新詞發現 
2. Human Correction: 發現的新詞和分詞，要經由人工校正並找出**詞意**是產品的詞彙
3. 神經網路學習 Product name 的組成

####Furtue work:

1. 第三步驟中，神經網路訓練可以疊代
2. 第一步驟中，加入字典的幫助，減少人工量




## Pattern Discovery
####目標：

* 冷啟動-無監督新詞發現
* 發現的詞用於之後深度學習
* 盡量減少第二步驟時的人工量

### 計算詞彙的 Entropy
把所有的詞彙組合找出來

####Run code
	python3 find_pattern/find_frequency_pattern_by_entropy.py
	
* **find\_frequency\_pattern\_by\_entropy.py** 的 input 是一個未分詞的文件
	* 預設在 **usr/find\_frequency\_pattern** 下的 **source.txt**

* output 有三, 預設放在 **usr/find\_frequency\_pattern/** 下。
	1. **word\_mutual\_entropy.txt**：記錄了 word 之間的 mutual entropy 格式如下 
		* 格式`詞彙	mutual entropy`,中間以 \t 隔開
		* EX: `卡通	0.09291187304856806`
	2. **word\_entropy.txt** 記錄了 word 左右兩側的自由度。
		* 格式：`詞彙	左側自由度	右側自由度` 中間以 \t 隔開
		* ex：`遥控特技车	0.6365141682948128	0.6365141682948128`

	3. **detail\_information.txt** 包含了詞彙的mutual entropy 以及跟左右兩側的自由度，還加入了詞彙出現在語料中的機率。
		*	格式：同時完整記錄每個詞彙的內部組成，中間以 \t 分開。

```
詞彙	出現機率	互消息	左entropy	右entropy
	左側組成 右側組成	左機率	右機率 左右機率相乘	組成間的互消息
	
--------------------------------------------------	
毛绒玩具礼品	0.000109	0.001067	1.831020	1.831020
	毛	绒玩具礼品	0.028833	0.000109	0.000003	0.000387
	毛绒	玩具礼品	0.025530	0.000864	0.000022	0.000174
	毛绒玩	具礼品	0.014916	0.000942	0.000014	0.000223
	毛绒玩具	礼品	0.014650	0.012643	0.000185	-0.000058
	毛绒玩具礼	品	0.000122	0.039404	0.000005	0.000340
```
最主要會用到 **detail\_information.txt** 其他兩個皆是參考, 決定hyper parameter用

### 分析 **detail\_information.txt**

此步驟分析 **detail\_information.txt** 輸出*可能有意義*的詞彙給接下來的人工審核。
有意義的詞包含了 *產品名* 和 *一般詞彙*。

	以下組合皆是有意義 ex: 毛绒玩具, 毛绒, 玩具

這是個比單純分詞還稍微困難點的問題，所有粒度都得概括，且每個粒度都必須有意義。

	室内儿童淘气堡: 室内儿童淘气堡, 儿童淘气堡, 淘气堡
以下是沒意義：
	
	室内儿童淘气堡: 内儿童淘气堡, 童淘气堡, 气堡

執行檔 **alg.py** 實現了一套框架以及演算法針對 **detail\_information.txt** 挖掘

####Run code

	python3 find_pattern/alg.py

* Input 即是上述 **detail\_information.txt**
* Ouput 有2，預設寫入 **usr/find\_frequency\_pattern** 之下
	1. **all_alg.txt**: 記錄了對每個字段**'可能形成有意義詞彙'**的評分
		* 格式： `字段	'accept score'	'reject score'`, 中間以 \t 分開
		* ex: 
	
	```
	儿童摇摆车      5.7813  0
	儿童摸鱼池      5.0308  0
	儿童支架游泳池  4.633   0
	儿童新款        20.9389 19.388
	```

	2. **filtered_alg.txt**: 初步將 accept score 大於 reject score 的字段挑選出來。當然， 挑選規則可以自行決定

####Alogrithmn
在 **alg.py** 對字段評分的思路如下：

1. threshold：最基本的塞選方式。衡量字段的互消息和左右兩側的 entropy，超過預設門檻則加分，低於門檻值則減分
	* Principle: 左右熵代表左右兩側的自由度，字段互消息代表字段字與字之間的內聚力。通常一個有意義的短詞，其內聚力較高，且左右兩側的自由度也高
	*  EX1 
	
	```
	字段	詞頻		字段互消息		左熵		右熵
	----------------------------------------------			
	唱歌	0.000737	0.004549	2.610286	3.012940
	唱歌的	0.000065	0.000546	0.858741	2.351673
	唱歌走	0.000057	0.000560	1.831020	-0.000000
	```
	
	字段**唱歌**的左右熵明顯較高，且內聚力較其他兩個高一個量級，所以**唱歌**兩字有更高的機率成為一個詞彙。
	
	* EX2

	```
	字段		詞頻			字段互消息		左熵		右熵
	------------------------------------------------------------
	充气玩沙池	0.000061	0.000468	1.831020	1.676988
	自控旋转飞机	0.000052	0.001105	-0.000000	-0.000000
	```
	threshold 塞選的方式有其局限性，對於組合的詞辨別力不佳。
	EX2 裡的兩個產品詞，兩者都無法直觀的透過自由度和內聚力辨別出。
2. 子承父業原則:
	* Priciple 如果字段的左熵低於 threshold, 那麼他的左側組成字段也該減分; 反之右側也成立。
	* EX

	```
	詞彙		出現機率	互消息	左entropy	右entropy
		左側組成 右側組成	左機率	右機率 左右機率相乘	組成間的互消息
---------------------------------------
	型充气滑梯	0.001771	0.015518	0.523315	3.900289
		型	充气滑梯	0.054027	0.012333	0.000666	0.001732
		型充	气滑梯	0.008682	0.012346	0.000107	0.004968
		型充气	滑梯	0.008664	0.036651	0.000318	0.003044
		型充气滑	梯	0.001837	0.037039	0.000068	0.005773
	```
	字段 **型充气滑梯** 的左熵不高，那 *型*、*型充*、*型充气*、*型充气滑* 都該減分

3. 服從多數原則：
	* Principle： 一個字段做為別的字段成員時，出現在最小消息量的次數愈多越可能是一個有效詞彙，因為組成詞的成員間互消息通常都是低的，尤其兩個有效詞彙組合成另一個有效組合詞時

		* 充气玩沙池 ＝ 充氣 ＋ 玩沙池
	
	```
	充气玩沙池	0.000061	0.000468	1.831020	1.676988
		充	气玩沙池	0.091123	0.000079	0.000007	0.000131
	S	充气	玩沙池	0.086538	0.000314	0.000027	0.000049
		充气玩	沙池	0.004843	0.002919	0.000014	0.000089
		充气玩沙	池	0.000074	0.031909	0.000002	0.000199
	```
	有效組合詞：充氣玩沙池。
	
	有效詞彙：充氣, 玩沙池。互消息量恰巧是最低的 0.000049
		 
	* EX
	
	```
	充气玩沙池	0.000061	0.000468	1.831020	1.676988
		充	气玩沙池	0.091123	0.000079	0.000007	0.000131
	S	充气	玩沙池	0.086538	0.000314	0.000027	0.000049
		充气玩	沙池	0.004843	0.002919	0.000014	0.000089
		充气玩沙	池	0.000074	0.031909	0.000002	0.000199
	```
	1. 排除 **充	气玩沙池** 和 **充气玩沙	池** 後，擁有最小互消息的是 **充气	玩沙池**
	2. 分別找出所有以 **充氣** 和 **玩沙池** 作為**前綴**和**後墜**的字段
	
	以下舉 **充氣** 的 **前綴** 當例子。
	**充氣**的**後綴**、**玩沙池**的**前綴**和**後墜**以此類推。
	排除單字影響，所以組成含有單字的組合不列入考慮。 ex：充 梯 机

	```
	充气大滑梯	0.005855	0.064265	3.639939	4.078224
		充	气大滑梯	0.091123	0.005868	0.000535	0.014012
	S	充气	大滑梯	0.086538	0.008302	0.000718	0.012283
		充气大	滑梯	0.006579	0.036651	0.000241	0.018675
		充气大滑	梯	0.005855	0.037039	0.000217	0.019296
	```
	```
	充气大滑梯价	0.000266	0.003092	2.864217	-0.000000
		充	气大滑梯价	0.091123	0.000266	0.000024	0.000638
	S	充气	大滑梯价	0.086538	0.000340	0.000029	0.000586
		充气大	滑梯价	0.006579	0.001549	0.000010	0.000868
		充气大滑	梯价	0.005855	0.001549	0.000009	0.000899
		充气大滑梯	价	0.005855	0.031088	0.000182	0.000101
	```
	
	```
	充气抓钱机	0.000070	0.001111	1.098612	1.098612
		充	气抓钱机	0.091123	0.000070	0.000006	0.000167
	S	充气	抓钱机	0.086538	0.000131	0.000011	0.000127
		充气抓	钱机	0.000070	0.000144	0.000000	0.000617
		充气抓钱	机	0.000070	0.057718	0.000004	0.000199
	```
	
	```
	充气攀岩出	0.000087	0.001090	2.163956	-0.000000
		充	气攀岩出	0.091123	0.000087	0.000008	0.000209
	S	充气	攀岩出	0.086538	0.000087	0.000008	0.000214
		充气攀	岩出	0.001771	0.000087	0.000000	0.000553
		充气攀岩	出	0.001771	0.013223	0.000023	0.000115
	```
	3.投票 多數: 四筆數據中 **充氣** 出現在最小互消息的次數為四次，故**充氣**加分
	
	4.若 **充氣** 和 **玩沙池** 都在各自的組成裡佔多數，則**充氣玩沙池**應當判定有效詞加分

4. 牽手原則：站左邊的人用右手牽，站右邊的用右手牽
	* Principle: 在一個有效的組合詞中，可以拆分成左側跟右側，通常左側的詞彙的右自由度，右側詞彙的左自由度高，若以上成立則此有效組合詞加分。
	* EX 繼續延伸第 3 點，充气玩沙池 ＝ 充氣 ＋ 玩沙池

 	```
	充气玩沙池	0.000061	0.000468	1.831020	1.676988
		充	气玩沙池	0.091123	0.000079	0.000007	0.000131
	S	充气	玩沙池	0.086538	0.000314	0.000027	0.000049
		充气玩	沙池	0.004843	0.002919	0.000014	0.000089
		充气玩沙	池	0.000074	0.031909	0.000002	0.000199
	```
	1. **充氣** 位於左側; **玩沙池** 位於右側。

	找出 **充氣** 的右熵和**玩沙池**的左熵
	
	```
	充气	0.086538	0.192417	4.030539	2.867237
	```
	
	```
	玩沙池	0.000314	0.000761	1.777973	2.506194
	```
	**充氣** 右熵是 2.86; **玩沙池** 左熵是1.77，都是很高的數值，故**充气玩沙池**應該是一個有效的詞彙。
